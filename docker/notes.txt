FROM continuumio/miniconda:4.7.12
MAINTAINER Audrey Stott

RUN apt-get -y install ttf-dejavu

COPY conda.yml .
RUN \
   conda env update -n root -f conda.yml \
   && conda clean -a

RUN apt-get install -y procps

FROM ubuntu:bionic
MAINTAINER Audrey Stott

RUN apt-get -y install \
    clang-6.0 \
    golang-1.11-go \
    python-2.7 \
    nodejs-8.11.4

RUN curl https://sh.rustup.rs -sSf | sh \
    && export PATH="$HOME/.cargo/bin:$PATH"

RUN git clone https://github.com/10XGenomics/cellranger.git \
    && cd cellranger \
    && make \
    && export PATH=/opt/cellranger-3.1.0:$PATH

RUN curl -o bcl2fastq2-v2.20.0.rpm bchttps://support.illumina.com/softwaredownload.html?assetId=e8ed3335-5201-48ff-a2bc-db4bfb792c85&assetDetails=bcl2fastq2-v2-20-0-linux-x86-64.zip \
    && yum install -y bcl2fastq2-v2.20.0.rpm






FROM ubuntu:bionic
MAINTAINER Audrey Stott

RUN curl -o cellranger-3.1.0.tar.gz "http://cf.10xgenomics.com/releases/cell-exp/cellranger-3.1.0.tar.gz?Expires=1574103830&Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cDovL2NmLjEweGdlbm9taWNzLmNvbS9yZWxlYXNlcy9jZWxsLWV4cC9jZWxscmFuZ2VyLTMuMS4wLnRhci5neiIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTU3NDEwMzgzMH19fV19&Signature=OCUMg~p8xr6RqpGNKvZApoXETi1Jeu7buq7xJwjNAWHUxthqeXn5VH0SVws60MOCqzp3RRshZ~Wr955BWNzxB-hvbjU9k~U74KADdN21Tpyw3YgNSMUHIW-PC2rLr~TbOnagKW9n1-rfY~3JHEppRglKVZk0Md-N1NeHf3xvzDocko1q3I~gfvk7ojbQLO0z8BIBhNCRUMjtcJJJwHZzLsytCurVaoWURODvvm2c2qtnGKRRSBGna6NqUrROwRfD8dmIhiGpXYQ4gRSxucpVxz8djU2pjL7GUp2ek~pP51D4u-OJD1AEvLhv3JiOwgqO575AYNSAz6X1CkZOC7VmBw__&Key-Pair-Id=APKAI7S6A5RYOXBWRPDA" \
    && tar -xzvf cellranger-3.1.0.tar.gz \
    && export PATH=/opt/cellranger-3.1.0:$PATH

ARG BCL_ZIP_VERSION="2-20-0"
ARG BCL_RPM_VERSION="2.20.0"

RUN curl -o bcl2fastq2-v${BCL_ZIP_VERSION} "https://support.illumina.com/softwaredownload.html?assetId=e8ed3335-5201-48ff-a2bc-db4bfb792c85&assetDetails=bcl2fastq2-v${BCL_ZIP_VERSION}-linux-x86-64.zip" \
    && unzip bcl2fastq2-v${BCL_ZIP_VERSION}-linux-x86-64.zip \
    && yum install -y bcl2fastq2-v${BCL_RPM_VERSION}-linux.rpm \
    && rm -rf bcl2fastq2-v${BCL_ZIP_VERSION}-linux-x86-64.zip

